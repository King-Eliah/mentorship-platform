import{r as o,j as s,n as I,p as R,X as W,v as z}from"./index-CDBseK31.js";import{U as L}from"./upload-D9WD5UwE.js";import{I as P,F as V}from"./image-CV-PZHWO.js";const K=({onFileUpload:N,onError:m,acceptedTypes:u=["image/*",".pdf",".doc",".docx",".txt"],maxSize:x=10,uploadEndpoint:F="/files/upload",multiple:c=!1,className:b="",showPreview:h=!0})=>{const[i,d]=o.useState([]),[y,g]=o.useState(!1),j=o.useRef(null),w=o.useCallback(e=>{if(e.size>x*1024*1024)return`File size must be less than ${x}MB`;const r=e.type,l=e.name.toLowerCase();return u.some(a=>{if(a.startsWith("."))return l.endsWith(a);if(a.includes("/*")){const n=a.split("/")[0];return r.startsWith(n)}return r===a})?null:`File type not supported. Accepted types: ${u.join(", ")}`},[u,x]),k=o.useCallback(e=>new Promise(r=>{if(e.type.startsWith("image/")){const l=new FileReader;l.onload=t=>r(t.target?.result),l.onerror=()=>r(void 0),l.readAsDataURL(e)}else r(void 0)}),[]),f=o.useCallback(async(e,r)=>{try{await(async()=>{for(let t=0;t<=100;t+=10)await new Promise(a=>setTimeout(a,50)),d(a=>a.map((n,p)=>p===r?{...n,progress:t}:n))})(),d(t=>t.map((a,n)=>n===r?{...a,uploading:!1,url:`mock-url-${e.name}`,progress:100}:a)),N(`mock-url-${e.name}`,e.name)}catch(l){const t=l instanceof Error?l.message:"Upload failed";d(a=>a.map((n,p)=>p===r?{...n,uploading:!1,error:t,progress:0}:n)),m?.(t)}},[F,N,m]),v=o.useCallback(async e=>{const r=Array.from(e);if(!c&&r.length>1){m?.("Only one file can be uploaded at a time");return}const l=[];for(const a of r){const n=w(a);if(n){m?.(n);continue}const p=h?await k(a):void 0;l.push({file:a,uploading:!0,progress:0,preview:p})}d(a=>c?[...a,...l]:l);const t=c?i.length:0;l.forEach((a,n)=>{f(a.file,t+n)})},[i.length,c,m,h,w,k,f]),C=o.useCallback(e=>{e.preventDefault(),g(!1);const r=e.dataTransfer.files;r.length>0&&v(r)},[v]),D=o.useCallback(e=>{e.preventDefault(),g(!0)},[]),U=o.useCallback(e=>{e.preventDefault(),g(!1)},[]),M=e=>{d(r=>r.filter((l,t)=>t!==e))},B=e=>{const r=i[e];r&&r.error&&(d(l=>l.map((t,a)=>a===e?{...t,error:void 0,uploading:!0,progress:0}:t)),f(r.file,e))},$=e=>e.type.startsWith("image/")?s.jsx(P,{className:"h-8 w-8 text-blue-500"}):s.jsx(V,{className:"h-8 w-8 text-gray-500"}),A=e=>{if(e===0)return"0 Bytes";const r=1024,l=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,t)).toFixed(2))+" "+l[t]};return s.jsxs("div",{className:`space-y-4 ${b}`,children:[s.jsxs("div",{className:`
          border-2 border-dashed rounded-lg p-6 text-center transition-colors
          ${y?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}
          ${i.some(e=>e.uploading)?"pointer-events-none opacity-75":"cursor-pointer"}
        `,onDrop:C,onDragOver:D,onDragLeave:U,onClick:()=>j.current?.click(),children:[s.jsx(L,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:y?"Drop files here":"Upload files"}),s.jsx("p",{className:"text-gray-600 mb-2",children:"Drag and drop files here, or click to select"}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Accepted: ",u.join(", ")," • Max size: ",x,"MB",c&&" • Multiple files allowed"]}),s.jsx("input",{ref:j,type:"file",className:"hidden",accept:u.join(","),multiple:c,onChange:e=>e.target.files&&v(e.target.files)})]}),i.length>0&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900",children:c?"Uploaded Files":"File Upload"}),i.map((e,r)=>s.jsx("div",{className:"border rounded-lg p-4 bg-white",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"flex-shrink-0",children:h&&e.preview?s.jsx("img",{src:e.preview,alt:"Preview",className:"h-12 w-12 object-cover rounded"}):$(e.file)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.file.name}),s.jsx("p",{className:"text-sm text-gray-500",children:A(e.file.size)})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[e.uploading&&s.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full"}),e.url&&!e.error&&s.jsx(I,{className:"h-5 w-5 text-green-500"}),e.error&&s.jsx(R,{className:"h-5 w-5 text-red-500"}),s.jsx("button",{onClick:()=>M(r),className:"text-gray-400 hover:text-gray-600",children:s.jsx(W,{className:"h-4 w-4"})})]})]}),e.uploading&&s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.progress}%`}})}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Uploading... ",e.progress,"%"]})]}),e.error&&s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{className:"text-sm text-red-600",children:e.error}),s.jsx(z,{size:"sm",variant:"secondary",className:"mt-1",onClick:()=>B(r),children:"Retry Upload"})]}),e.url&&!e.error&&s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{className:"text-sm text-green-600",children:"Upload successful!"}),h&&e.url&&s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"View file"})]})]})]})},r))]})]})};export{K as F};
