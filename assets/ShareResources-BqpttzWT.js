import{u as T,r as o,R as J,f as R,j as e,s as w,w as N,v as y,n as z,I,z as i}from"./index-C3bYRuX8.js";import{U as P}from"./upload-BlEDV91L.js";import{S as _}from"./share-2-Cz5nGeGm.js";const L=()=>{const{user:h}=T(),[d,S]=o.useState([]),[t,g]=o.useState(new Set),[a,u]=o.useState(new Set),[c,C]=o.useState([]),[m,v]=o.useState("existing"),[x,f]=o.useState({title:"",description:""}),[l,k]=o.useState(null);o.useEffect(()=>{U(),A()},[]);const U=()=>{const r=JSON.parse(localStorage.getItem("resources")||"[]");S(r)},A=async()=>{if(h?.role===J.MENTOR)try{if((await R.getGroups()).find(n=>n.mentorId===h.id)){const j=(await R.getUsers()).filter(b=>b.role==="MENTEE"&&b.isActive);C(j)}}catch(r){console.error("Failed to fetch mentees:",r)}},E=r=>{const s=new Set(t);s.has(r)?s.delete(r):s.add(r),g(s)},F=r=>{const s=new Set(a);s.has(r)?s.delete(r):s.add(r),u(s)},M=()=>{t.size===d.length?g(new Set):g(new Set(d.map(r=>r.id)))},$=()=>{a.size===c.length?u(new Set):u(new Set(c.map(r=>r.id)))},D=()=>{if(t.size===0){i.error("Please select at least one resource to share");return}if(a.size===0){i.error("Please select at least one mentee to share with");return}try{a.forEach(r=>{const s=JSON.parse(localStorage.getItem(`shared_resources_${r}`)||"[]"),n=new Set([...s,...Array.from(t)]);localStorage.setItem(`shared_resources_${r}`,JSON.stringify(Array.from(n)))}),i.success(`Shared ${t.size} resource(s) with ${a.size} mentee(s)`),g(new Set),u(new Set)}catch(r){console.error("Failed to share resources:",r),i.error("Failed to share resources")}},O=async()=>{if(!x.title.trim()||!l){i.error("Please provide a title and select a file");return}try{const r=await new Promise((j,b)=>{const p=new FileReader;p.onload=()=>j(p.result),p.onerror=b,p.readAsDataURL(l)}),s={id:Date.now().toString(),title:x.title,description:x.description,category:"learning-materials",fileName:l.name,originalFileName:l.name,fileSize:l.size,uploadedBy:h?.firstName+" "+h?.lastName||"Unknown",uploadedAt:new Date().toISOString(),downloadCount:0,fileData:r,fileType:l.type},n=JSON.parse(localStorage.getItem("resources")||"[]");localStorage.setItem("resources",JSON.stringify([s,...n])),S([s,...d]),f({title:"",description:""}),k(null),i.success("Resource uploaded successfully"),window.dispatchEvent(new CustomEvent("resourcesUpdated"))}catch(r){console.error("Failed to upload resource:",r),i.error("Failed to upload file")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Share Resources"}),e.jsx("p",{className:"mt-1 text-gray-600 dark:text-gray-400",children:"Share learning materials and resources with your mentees"})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>v("existing"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${m==="existing"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Share Existing Resources"}),e.jsx("button",{onClick:()=>v("upload"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${m==="upload"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Upload & Share New"})]})}),m==="existing"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(w,{children:e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Select Resources (",t.size," selected)"]}),e.jsx(y,{variant:"outline",size:"sm",onClick:M,children:t.size===d.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:d.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No resources available"}):d.map(r=>e.jsx("div",{onClick:()=>E(r.id),className:`p-3 border rounded-lg cursor-pointer transition-colors ${t.has(r.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`mt-1 w-5 h-5 rounded border-2 flex items-center justify-center ${t.has(r.id)?"border-blue-500 bg-blue-500":"border-gray-300 dark:border-gray-600"}`,children:t.has(r.id)&&e.jsx(z,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:r.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:r.description})]})]})},r.id))})]})}),e.jsx(w,{children:e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Select Mentees (",a.size," selected)"]}),e.jsx(y,{variant:"outline",size:"sm",onClick:$,children:a.size===c.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:c.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No mentees found"}):c.map(r=>e.jsx("div",{onClick:()=>F(r.id),className:`p-3 border rounded-lg cursor-pointer transition-colors ${a.has(r.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${a.has(r.id)?"border-blue-500 bg-blue-500":"border-gray-300 dark:border-gray-600"}`,children:a.has(r.id)&&e.jsx(z,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold",children:[r.firstName?.[0],r.lastName?.[0]]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white",children:[r.firstName," ",r.lastName]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.email})]})]})},r.id))})]})})]}):e.jsx(w,{children:e.jsxs(N,{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Upload New Resource"}),e.jsx(I,{label:"Title",value:x.title,onChange:r=>f(s=>({...s,title:r.target.value})),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:x.description,onChange:r=>f(s=>({...s,description:r.target.value})),placeholder:"Enter resource description...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"File"}),e.jsx("input",{type:"file",onChange:r=>{const s=r.target.files?.[0];s&&k(s)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),l&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Selected: ",l.name]})]}),e.jsxs(y,{onClick:O,className:"w-full",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Upload Resource"]})]})}),m==="existing"&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(y,{onClick:D,disabled:t.size===0||a.size===0,size:"lg",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Share ",t.size," Resource(s) with ",a.size," Mentee(s)"]})})]})};export{L as ShareResources};
