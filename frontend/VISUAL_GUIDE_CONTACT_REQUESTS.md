# Contact Request System - Visual Guide

## User Interface Flow

### 1. Messages Page Tabs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Messages                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Chats] [People] [Requests â“˜ 3]            â”‚
â”‚  Search...                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Content based on active tab                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. People Tab View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  People Tab (Browse Users)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ John Mentor          [Add]              â”‚  â† Not connected
â”‚  ğŸ‘¤ Jane Mentee        [Pending] ğŸŸ¨        â”‚  â† Request sent
â”‚  ğŸ‘¤ Admin User         [Message]            â”‚  â† Already contact
â”‚  ğŸ‘¤ Sarah Coach          [Add]              â”‚  â† Not connected
â”‚                                             â”‚
â”‚  Scroll for more users...                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Requests Tab View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Requests Tab (3 pending)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ Alice Smith                             â”‚
â”‚     Mentor - wants to add you              â”‚
â”‚     "Let's collaborate on projects"         â”‚
â”‚     [Decline]     [Accept]                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ Bob Johnson                             â”‚
â”‚     Mentee - wants to add you              â”‚
â”‚     [Decline]     [Accept]                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ Carol Davis                             â”‚
â”‚     Admin - wants to add you               â”‚
â”‚     [Decline]     [Accept]                 â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Flow Diagrams

### Contact Request Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   START     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User A clicks "Add"       â”‚
â”‚   on User B in People tab   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ POST /api/contacts/request/send
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Request created           â”‚
â”‚   Status: PENDING           â”‚
â”‚   Stored in database        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                         â”‚
       â–¼ (User A's view)         â–¼ (User B's view)
   "Pending"              Shows in Requests tab
   badge visible          with badge count
       â”‚                         â”‚
       â”‚                         â–¼
       â”‚                  User B clicks Accept
       â”‚                         â”‚
       â”‚                         â–¼ PATCH /api/contacts/request/{id}/accept
       â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                  â”‚ Status: ACCEPTED â”‚
       â”‚                  â”‚ Contacts created â”‚
       â”‚                  â”‚ respondedAt set  â”‚
       â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                         â”‚
       â–¼ (Re-query contacts)     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User B visible   â”‚     â”‚ User A visible   â”‚
   â”‚ in contacts      â”‚     â”‚ in contacts      â”‚
   â”‚ Can message!     â”‚     â”‚ Can message!     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Rejection Path

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User B clicks       â”‚
        â”‚ "Decline"           â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ PATCH /api/contacts/request/{id}/reject
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Status: REJECTED     â”‚
        â”‚ respondedAt set      â”‚
        â”‚ NO contact created   â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Request disappears   â”‚
        â”‚ from Requests tab    â”‚
        â”‚ User A sees "Add"    â”‚
        â”‚ button again         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Model Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         User             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID)                â”‚
â”‚ firstName                â”‚
â”‚ lastName                 â”‚
â”‚ email                    â”‚
â”‚ role                     â”‚
â”‚ blockedUsers[]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
         â”‚              â”‚
         â”‚              â”‚ (Relations)
         â”‚              â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”
    â”‚ ContactRequest       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (UUID)            â”‚
    â”‚ senderId â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚ receiverId â”€â”  â”‚     â”‚
    â”‚ status      â”‚  â”‚     â”‚
    â”‚ message     â”‚  â”‚     â”‚
    â”‚ createdAt   â”‚  â”‚     â”‚
    â”‚ respondedAt â”‚  â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
                  â”‚  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”
           â”‚                â”‚
      (FK ref)         (FK ref)
           â”‚                â”‚
           â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ contactRequestsSent      â”‚ (Relation)
    â”‚ contactRequestsReceived  â”‚ (Relation)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â””â”€ Also related to Contact model
       when status = ACCEPTED
```

---

## API Request/Response Examples

### 1. Send Contact Request

**Request:**

```http
POST /api/contacts/request/send
Authorization: Bearer {token}
Content-Type: application/json

{
  "receiverId": "user-123",
  "message": "I'd love to connect!"
}
```

**Response (201):**

```json
{
  "id": "req-456",
  "senderId": "user-789",
  "receiverId": "user-123",
  "status": "PENDING",
  "message": "I'd love to connect!",
  "createdAt": "2024-11-20T10:30:00Z",
  "respondedAt": null,
  "sender": {
    "id": "user-789",
    "firstName": "Alice",
    "lastName": "Smith",
    "avatar": "https://...",
    "email": "alice@example.com",
    "role": "MENTOR"
  }
}
```

**Response (400) - Duplicate:**

```json
{
  "message": "Request already exists"
}
```

### 2. Get Pending Requests

**Request:**

```http
GET /api/contacts/request/pending
Authorization: Bearer {token}
```

**Response (200):**

```json
{
  "requests": [
    {
      "id": "req-456",
      "senderId": "user-111",
      "status": "PENDING",
      "message": "Connect?",
      "createdAt": "2024-11-20T10:00:00Z",
      "sender": {
        "id": "user-111",
        "firstName": "Bob",
        "lastName": "Johnson"
      }
    },
    {
      "id": "req-457",
      "senderId": "user-222",
      "status": "PENDING",
      "createdAt": "2024-11-20T09:00:00Z",
      "sender": {
        "id": "user-222",
        "firstName": "Carol",
        "lastName": "Davis"
      }
    }
  ],
  "total": 2
}
```

### 3. Accept Request

**Request:**

```http
PATCH /api/contacts/request/req-456/accept
Authorization: Bearer {token}
```

**Response (200):**

```json
{
  "message": "Request accepted",
  "request": {
    "id": "req-456",
    "status": "ACCEPTED",
    "respondedAt": "2024-11-20T10:35:00Z"
  }
}
```

### 4. Reject Request

**Request:**

```http
PATCH /api/contacts/request/req-456/reject
Authorization: Bearer {token}
```

**Response (200):**

```json
{
  "message": "Request rejected",
  "request": {
    "id": "req-456",
    "status": "REJECTED",
    "respondedAt": "2024-11-20T10:35:00Z"
  }
}
```

---

## UI Component States

### Add Button States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Add] (idle)     â”‚  â† Initial state
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ clicked
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Add] (loading)  â”‚  â† Disabled while sending
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ success
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pending ğŸŸ¨       â”‚  â† Shows pending status
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Badge States

```
Single Count:                Badge Color Codes:
[Requests 3]                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â†‘                       â”‚ ğŸ”´ Red = Urgent â”‚
   Count                     â”‚ (pending count) â”‚
                             â”‚                 â”‚
Hover effect:                â”‚ ğŸŸ¨ Yellow       â”‚
[Requests]  â†’  [Requests]    â”‚ (request sent)  â”‚
           (grows slightly)   â”‚                 â”‚
                             â”‚ ğŸŸ¢ Green        â”‚
                             â”‚ (accepted)      â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## User Journey Map

### User A (Sender)

```
Login
  â”‚
  â–¼
Messages page
  â”‚
  â”œâ”€â†’ [Chats] tab
  â”‚     (existing conversations)
  â”‚
  â”œâ”€â†’ [People] tab â—„â”€â”€â”€ Start here!
  â”‚     â”‚
  â”‚     â”œâ”€ Sees list of all users
  â”‚     â”œâ”€ Finds "Jane Mentee"
  â”‚     â””â”€ Clicks "Add" button
  â”‚           â”‚
  â”‚           â–¼
  â”‚     Button changes to "Pending"
  â”‚     Toast: "Contact request sent!"
  â”‚
  â””â”€â†’ [Requests] tab
        (no incoming requests)
```

### User B (Receiver)

```
Login
  â”‚
  â–¼
Messages page
  â”‚
  â”œâ”€â†’ [Chats] tab
  â”‚
  â”œâ”€â†’ [People] tab
  â”‚     (regular users)
  â”‚
  â””â”€â†’ [Requests] tab â—„â”€â”€â”€ Badge shows count!
        â”‚
        â”œâ”€ Sees "Alice Smith" request
        â”œâ”€ Reads message: "I'd love to connect!"
        â”‚
        â”œâ”€â†’ Clicks "Accept"
        â”‚     â”‚
        â”‚     â–¼
        â”‚   Toast: "Contact added!"
        â”‚   Alice now in Contacts
        â”‚   Can message immediately
        â”‚
        â””â”€â†’ Clicks "Decline"
              â”‚
              â–¼
            Toast: "Request declined"
            Request removed from tab
            Alice can resend later
```

---

## Timeline Example

**10:00** - Alice sees Bob in People tab, clicks Add
â†’ Request created, Alice sees "Pending" badge

**10:05** - Bob opens Requests tab
â†’ Sees Alice's request with red badge (1)

**10:06** - Bob clicks Accept
â†’ Toast shows "Contact added!"
â†’ Alice appears in Bob's Contacts
â†’ Bob appears in Alice's Contacts

**10:10** - Alice clicks to message Bob
â†’ Opens conversation
â†’ Can send message immediately

---

## Validation Rules

```
âœ… ALLOWED                          âŒ NOT ALLOWED
â”œâ”€ Send to any user                 â”œâ”€ Send to self
â”œâ”€ Send to users in other groups    â”œâ”€ Send to existing contact
â”œâ”€ Resend after rejection           â”œâ”€ Send duplicate request
â”œâ”€ Optional message                 â”œâ”€ Empty message (can be omitted)
â””â”€ Multiple simultaneous requests   â””â”€ Send to blocked users
    (between different pairs)           (future enhancement)
```

---

## Database Query Patterns

### Find All Pending Requests for User

```sql
SELECT * FROM "ContactRequest"
WHERE "receiverId" = {userId}
  AND "status" = 'PENDING'
ORDER BY "createdAt" DESC;
```

### Find Request Status Between Two Users

```sql
SELECT "status" FROM "ContactRequest"
WHERE ("senderId" = {userA} AND "receiverId" = {userB})
   OR ("senderId" = {userB} AND "receiverId" = {userA});
```

### Check if Users Can Connect

```sql
SELECT COUNT(*) FROM "Contact"
WHERE ("userId" = {userA} AND "contactUserId" = {userB})
   OR ("userId" = {userB} AND "contactUserId" = {userA});
```

---

## Performance Characteristics

```
Operation              Time     Database
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Send Request          <500ms   INSERT 1 row
Get Pending           <300ms   SELECT 10-50 rows*
Accept Request        <500ms   UPDATE 1, INSERT 2 rows
Reject Request        <300ms   UPDATE 1 row
Load Requests Tab     <1s      GET pending + batch fetch senders

* Depends on number of pending requests
```
